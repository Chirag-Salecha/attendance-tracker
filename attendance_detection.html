<!DOCTYPE html>
<html>
<head>
<title>AttendFlow | Attendance Analytics Demo</title>

<style>
*{box-sizing:border-box}

body{
    margin:0;
    font-family:"Segoe UI", Arial, sans-serif;
    background:#eef1f6;
    color:#1f2937;
}

/* HEADER */
.header{
    background:#111827;
    color:white;
    padding:25px;
    text-align:center;
}

.header h1{ margin:0; font-size:34px; }
.header p{ margin-top:8px; color:#cbd5e1; }

/* MAIN */
.container{
    max-width:1200px;
    margin:30px auto;
    padding:0 20px;
}

/* CARD */
.card{
    background:white;
    border-radius:14px;
    padding:25px;
    margin-bottom:30px;
    box-shadow:0 8px 25px rgba(0,0,0,0.08);
}

.card h3{ margin-top:0; }

/* INPUT GRID */
.student{
    display:grid;
    grid-template-columns:1fr 2fr;
    gap:12px;
    margin-bottom:12px;
}

input{
    padding:12px;
    border-radius:8px;
    border:1px solid #cbd5e1;
    font-size:14px;
}

button{
    margin-top:8px;
    padding:10px 16px;
    border:none;
    border-radius:20px;
    background:#2563eb;
    color:white;
    font-size:14px;
    font-weight:600;
    cursor:pointer;
}

button:hover{ background:#1d4ed8; }

/* CLASSIFICATION */
.grid{
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:20px;
}

.box{
    padding:15px;
    border-radius:10px;
    background:#f9fafb;
    min-height:160px;
}

.red{border-left:6px solid #dc2626;}
.orange{border-left:6px solid #d97706;}
.green{border-left:6px solid #15803d;}

.box h4{ margin-top:0; }

/* MESSAGE PREVIEW */
.msg-box{
    background:#eef2ff;
    padding:8px;
    border-radius:6px;
    font-size:13px;
    margin:6px 0;
}

/* GRAPH */
canvas{
    margin-top:20px;
    background:#f9fafb;
    border-radius:10px;
    padding:10px;
}

/* FOOTER */
.footer{
    text-align:center;
    padding:15px;
    color:#64748b;
    font-size:13px;
}
</style>
</head>

<body>

<div class="header">
    <h1>AttendFlow Analytics</h1>
    <p>Algorithm-Driven Attendance Pattern Detection</p>
</div>

<div class="container">

<!-- INPUT -->
<div class="card">
    <h3>1. Attendance Data Input</h3>
    <p><b>P</b> = Present, <b>A</b> = Absent<br>
       Example: <code>P,A,A,A,P</code></p>

    <div class="student">
        <input id="name1" placeholder="Student 1 Name">
        <input id="att1" placeholder="P,A,A,A,P">
    </div>
    <div class="student">
        <input id="name2" placeholder="Student 2 Name">
        <input id="att2" placeholder="P,P,P,A,P">
    </div>
    <div class="student">
        <input id="name3" placeholder="Student 3 Name">
        <input id="att3" placeholder="P,A,P,A,A">
    </div>
    <div class="student">
        <input id="name4" placeholder="Student 4 Name">
        <input id="att4" placeholder="P,P,P,P,P">
    </div>

    <button onclick="analyze()">DETECT ATTENDANCE</button>
</div>

<!-- CLASSIFICATION -->
<div class="card">
    <h3>2. Attendance Classification & SMS Notification</h3>

    <div class="grid">
        <div class="box red">
            <h4>Consecutive Absentees</h4>
            <div id="consecutive"></div>
        </div>

        <div class="box orange">
            <h4>Low Attendance</h4>
            <div id="low"></div>
        </div>

        <div class="box green">
            <h4>Normal Attendance</h4>
            <div id="normal"></div>
        </div>
    </div>
</div>

<!-- GRAPH -->
<div class="card">
    <h3>3. Attendance Percentage Visualization</h3>
    <canvas id="chart" width="1100" height="350"></canvas>

    <p style="font-size:14px;color:#475569;">
        <b>Algorithm Insight:</b><br>
        Sliding Window (size = 3) detects consecutive absences.
        Linear traversal computes attendance percentage.<br>
        <b>Time:</b> O(n) &nbsp;&nbsp; <b>Space:</b> O(1)
    </p>
</div>

</div>

<div class="footer">
DAA Course Project • Student Attendance Pattern Tracker • KLE Technological University
</div>

<script>
function analyze(){
    let names=[], values=[], categories=[];

    document.getElementById("consecutive").innerHTML="";
    document.getElementById("low").innerHTML="";
    document.getElementById("normal").innerHTML="";

    for(let i=1;i<=4;i++){
        let name=document.getElementById("name"+i).value || "Student "+i;
        let s=document.getElementById("att"+i).value.toUpperCase()
              .replace(/,/g,"").replace(/\s+/g,"");

        if(!/^[PA]+$/.test(s)) continue;

        let hasAAA=false;
        for(let j=0;j<=s.length-3;j++){
            if(s.substring(j,j+3)==="AAA"){ hasAAA=true; break; }
        }

        let present=0;
        for(let c of s) if(c==="P") present++;
        let percent=(present/s.length)*100;

        if(hasAAA){
            document.getElementById("consecutive").innerHTML+=
            studentBlock(name,percent,"Consecutive Absentee");
            categories.push("consecutive");
        }
        else if(percent<75){
            document.getElementById("low").innerHTML+=
            studentBlock(name,percent,"Low Attendance");
            categories.push("low");
        }
        else{
            document.getElementById("normal").innerHTML+=
            `<b>${name}</b> (${percent.toFixed(1)}%)<hr>`;
            categories.push("normal");
        }

        names.push(name);
        values.push(percent);
    }

    drawGraph(names,values,categories);
}

function studentBlock(name,percent,category){
    let message =
        "Attendance Alert:\n" +
        "Student: " + name + "\n" +
        "Category: " + category + "\n" +
        "Attendance: " + percent.toFixed(1) + "%\n" +
        "Please take necessary action.";

    return `
    <b>${name}</b> (${percent.toFixed(1)}%)<br>

    <div class="msg-box">
        <b>SMS Preview:</b><br>
        ${message.replace(/\n/g,"<br>")}
    </div>

    <button onclick="sendSMS('${name}', \`${message}\`)">
        Send Message
    </button>

    <div id="status_${name}" style="font-size:13px;color:green;"></div>
    <hr>`;
}

function sendSMS(name,message){
    document.getElementById("status_"+name).innerHTML =
        "✅ Message Sent Successfully";

    alert("SMS SENT (Demo):\n\n" + message);
}

/* GRAPH */
function drawGraph(names,values,categories){
    let c=document.getElementById("chart");
    let ctx=c.getContext("2d");
    ctx.clearRect(0,0,c.width,c.height);

    let left=90, right=1050, top=50, bottom=300;
    let height=bottom-top;

    ctx.strokeStyle="#000"; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(left,top); ctx.lineTo(left,bottom); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(left,bottom); ctx.lineTo(right,bottom); ctx.stroke();

    ctx.font="13px Arial"; ctx.fillStyle="#000";
    for(let i=0;i<=100;i+=25){
        let y=bottom-(i/100)*height;
        ctx.fillText(i+"%",40,y+5);
        ctx.strokeStyle="#ddd";
        ctx.beginPath(); ctx.moveTo(left,y); ctx.lineTo(right,y); ctx.stroke();
    }

    let barWidth=80, gap=70;
    for(let i=0;i<values.length;i++){
        let h=(values[i]/100)*height;
        let x=left+40+i*(barWidth+gap);
        let y=bottom-h;

        let color=
            categories[i]==="consecutive"?"#dc2626":
            categories[i]==="low"?"#d97706":"#15803d";

        ctx.fillStyle=color;
        ctx.fillRect(x,y,barWidth,h);

        ctx.fillStyle="#000";
        ctx.fillText(values[i].toFixed(1)+"%",x+18,y-8);
        ctx.fillText(names[i],x,bottom+22);
    }
}
</script>

</body>
</html>
