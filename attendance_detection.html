<!DOCTYPE html>
<html>
<head>
<title>AttendFlow ‚Äì Attendance Entry & Pattern Detection</title>

<style>
body{
  margin:0;
  font-family:Segoe UI, Arial, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
}
.header{
  background:#020617;
  padding:25px;
  text-align:center;
}
.container{
  max-width:1200px;
  margin:30px auto;
  padding:0 20px;
}
.card{
  background:#020617;
  padding:25px;
  border-radius:14px;
  margin-bottom:30px;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid #334155;
  padding:10px;
  text-align:center;
}
input{
  width:110px;
  padding:6px;
  text-align:center;
}
.att{ width:55px; }
button{
  margin-top:12px;
  padding:10px 18px;
  background:#22c55e;
  color:#020617;
  font-weight:bold;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
button:hover{ background:#16a34a; }

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:20px;
}
.box{
  padding:15px;
  border-radius:10px;
  min-height:180px;
}
.red{ background:#7f1d1d; }
.orange{ background:#78350f; }
.green{ background:#064e3b; }

.msg{
  font-size:13px;
  color:#fde68a;
}
.status{
  font-size:13px;
  color:#86efac;
}

canvas{
  margin-top:20px;
  background:#020617;
}
</style>
</head>

<body>

<div class="header">
<h1>AttendFlow Analytics</h1>
<p>Attendance Entry + Pattern Detection (Sliding Window)</p>
</div>

<div class="container">

<!-- ENTRY -->
<div class="card">
<h3>1Ô∏è‚É£ Enter Attendance (5 Dates)</h3>
<p><b>P</b> = Present, <b>A</b> = Absent</p>

<table>
<tr>
<th>Roll</th>
<th><input type="date" id="d1"></th>
<th><input type="date" id="d2"></th>
<th><input type="date" id="d3"></th>
<th><input type="date" id="d4"></th>
<th><input type="date" id="d5"></th>
</tr>

<tr>
<td>101</td>
<td><input class="att" id="101_1"></td>
<td><input class="att" id="101_2"></td>
<td><input class="att" id="101_3"></td>
<td><input class="att" id="101_4"></td>
<td><input class="att" id="101_5"></td>
</tr>

<tr>
<td>102</td>
<td><input class="att" id="102_1"></td>
<td><input class="att" id="102_2"></td>
<td><input class="att" id="102_3"></td>
<td><input class="att" id="102_4"></td>
<td><input class="att" id="102_5"></td>
</tr>

<tr>
<td>103</td>
<td><input class="att" id="103_1"></td>
<td><input class="att" id="103_2"></td>
<td><input class="att" id="103_3"></td>
<td><input class="att" id="103_4"></td>
<td><input class="att" id="103_5"></td>
</tr>

<tr>
<td>104</td>
<td><input class="att" id="104_1"></td>
<td><input class="att" id="104_2"></td>
<td><input class="att" id="104_3"></td>
<td><input class="att" id="104_4"></td>
<td><input class="att" id="104_5"></td>
</tr>

<tr>
<td>105</td>
<td><input class="att" id="105_1"></td>
<td><input class="att" id="105_2"></td>
<td><input class="att" id="105_3"></td>
<td><input class="att" id="105_4"></td>
<td><input class="att" id="105_5"></td>
</tr>
</table>

<button onclick="analyze()">Save & Detect Patterns</button>
<button onclick="goHistory()">View Saved History</button>
</div>

<!-- OUTPUT -->
<div class="card">
<h3>2Ô∏è‚É£ Pattern Detection & Alerts</h3>

<div class="grid">

<div class="box red">
<h4>üî¥ Consecutive Absentees</h4>
<div id="consecutive"></div>
</div>

<div class="box orange">
<h4>üü† Low Attendance (&lt;75%)</h4>
<div id="low"></div>
</div>

<div class="box green">
<h4>üü¢ Normal Attendance</h4>
<div id="normal"></div>
</div>

</div>
</div>

<!-- GRAPH -->
<div class="card">
<h3>3Ô∏è‚É£ Attendance Percentage Graph</h3>
<canvas id="chart" width="1000" height="300"></canvas>
</div>

</div>

<script>
function analyze(){
  let cons="", low="", norm="";
  let names=[], values=[];
  let dates=[d1.value,d2.value,d3.value,d4.value,d5.value];

  let studentData={};

  ["101","102","103","104","105"].forEach(r=>{
    let arr=[], record=[];
    for(let i=1;i<=5;i++){
      let v=document.getElementById(r+"_"+i).value.toUpperCase();
      let val=(v==="A"||v==="P")?v:"P";
      arr.push(val);
      record.push(dates[i-1]+":"+val);
    }
    studentData[r]=arr;

    let hasAAA=false;
    for(let i=0;i<=arr.length-3;i++){
      if(arr.slice(i,i+3).join("")==="AAA"){ hasAAA=true; break; }
    }

    let p=arr.filter(x=>x==="P").length;
    let per=(p/5)*100;

    if(hasAAA){
      cons+=`Roll ${r}<br>${record.join(" | ")} (${per}%)<br>
      <div class="msg">SMS Preview: Consecutive absences detected</div>
      <button onclick="sendMessage('${r}')">Send Message</button>
      <div id="status_${r}" class="status"></div><br>`;
    }
    else if(per<75){
      low+=`Roll ${r}<br>${record.join(" | ")} (${per}%)<br>
      <div class="msg">SMS Preview: Attendance below 75%</div>
      <button onclick="sendMessage('${r}')">Send Message</button>
      <div id="status_${r}" class="status"></div><br>`;
    }
    else{
      norm+=`Roll ${r}<br>${record.join(" | ")} (${per}%)<br><br>`;
    }

    names.push("R"+r);
    values.push(per);
  });

  saveToHistory(dates, studentData);

  document.getElementById("consecutive").innerHTML=cons;
  document.getElementById("low").innerHTML=low;
  document.getElementById("normal").innerHTML=norm;

  drawGraph(names,values);
}

function saveToHistory(dates, data){
  let history = JSON.parse(localStorage.getItem("attendanceHistory")) || [];
  history.push({ dates: dates, data: data });
  localStorage.setItem("attendanceHistory", JSON.stringify(history));
}

function sendMessage(roll){
  document.getElementById("status_"+roll).innerHTML="‚úÖ Message Sent Successfully";
  alert("SMS SENT (Demo)\n\nAttendance alert for Roll "+roll);
}

function goHistory(){
  window.location.href = "history.html";
}


function drawGraph(names,vals){
  let c=document.getElementById("chart");
  let ctx=c.getContext("2d");
  ctx.clearRect(0,0,c.width,c.height);

  ctx.strokeStyle="#94a3b8";
  ctx.beginPath();
  ctx.moveTo(50,20);
  ctx.lineTo(50,260);
  ctx.lineTo(950,260);
  ctx.stroke();

  let x=100,w=60,g=80;
  ctx.fillStyle="#22c55e";

  for(let i=0;i<vals.length;i++){
    let h=(vals[i]/100)*180;
    ctx.fillRect(x,260-h,w,h);
    ctx.fillText(vals[i]+"%",x,250-h);
    ctx.fillText(names[i],x,280);
    x+=w+g;
  }
}
</script>

</body>
</html>
